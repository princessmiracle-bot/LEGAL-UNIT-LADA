<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Surat Masuk (Admin) | Unit Undang-Undang</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{margin:0;background:#f4f7fb;color:#333}

/* HEADER */
header{
  background:#fff;
  padding:18px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 6px 24px rgba(0,0,0,.06);
}
.header-left h1{margin:0;font-size:18px;color:#2f66d4}
.header-left span{font-size:12px;color:#777}
header button{
  background:#e74c3c;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:12px;
  font-size:13px;
  cursor:pointer;
}

/* CONTAINER */
.container{
  max-width:1600px;
  margin:30px auto 50px;
  padding:0 20px;
}

/* TOP BAR */
.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}
.top-bar h3{margin:0;font-size:16px}
.top-bar p{margin:4px 0 0;font-size:12px;color:#666}
.top-bar button{
  background:linear-gradient(135deg,#4f8cff,#2f66d4);
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:14px;
  font-size:13px;
  cursor:pointer;
  box-shadow:0 10px 25px rgba(47,102,212,.35);
}

/* FILTER */
.filter-bar{
  background:#fff;
  padding:16px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
  display:grid;
  grid-template-columns:2fr 1fr 1fr auto;
  gap:14px;
  margin-bottom:20px;
}
.filter-bar input,
.filter-bar select{
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:13px;
}
.filter-bar button{
  background:#2f66d4;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:10px 18px;
  cursor:pointer;
}

/* TABLE */
.table-wrapper{
  background:#fff;
  border-radius:18px;
  overflow:auto;
  box-shadow:0 18px 40px rgba(0,0,0,.08);
}
table{
  width:100%;
  min-width:1600px;
  border-collapse:collapse;
}
th,td{
  padding:14px;
  font-size:13px;
  vertical-align:top;
}
th{
  background:#f1f4fb;
  font-weight:600;
  white-space:nowrap;
}
tr:not(:last-child){border-bottom:1px solid #eee}

/* ACTION */
.action-btn{
  border:none;
  padding:6px 12px;
  border-radius:10px;
  font-size:12px;
  cursor:pointer;
  margin-right:6px;
}
.edit{background:#f1c40f}
.delete{background:#e74c3c;color:#fff}

.empty{
  text-align:center;
  padding:40px;
  color:#777;
}
</style>
</head>

<body>

<header>
  <div class="header-left">
    <h1>Surat Masuk (Admin)</h1>
    <span>Unit Undang-Undang Â· LADA</span>
  </div>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

  <div class="top-bar">
    <div>
      <h3>Senarai Surat</h3>
      <p>Pengurusan surat masuk Unit Undang-Undang</p>
    </div>

    <!-- BUTTON BACKUP EXCEL -->
    <div style="display:flex; gap:10px">
      <button onclick="exportExcel()">ðŸ“¥ Backup Excel</button>
      <button onclick="tambahSurat()">+ Tambah Surat</button>
    </div>
  </div>

  <!-- FILTER -->
  <div class="filter-bar">
    <input type="text" id="searchInput" placeholder="Cari perkara / pengirim">

    <select id="bulanFilter">
      <option value="">Semua Bulan</option>
      <option value="01">Januari</option>
      <option value="02">Februari</option>
      <option value="03">Mac</option>
      <option value="04">April</option>
      <option value="05">Mei</option>
      <option value="06">Jun</option>
      <option value="07">Julai</option>
      <option value="08">Ogos</option>
      <option value="09">September</option>
      <option value="10">Oktober</option>
      <option value="11">November</option>
      <option value="12">Disember</option>
    </select>

    <select id="kategoriFilter">
      <option value="">Semua Kategori</option>
      <option>Memo</option>
      <option>Surat/Dokumen</option>
      <option>Emel</option>
      <option>DDMS</option>
    </select>

    <button onclick="applyFilter()">Cari</button>
  </div>

  <!-- TABLE -->
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Kategori</th>
          <th>Pengirim</th>
          <th>Tarikh Terima</th>
          <th>Tarikh Surat</th>
          <th>Perkara / Tajuk</th>
          <th>Minit Tindakan</th>
          <th>Kepada</th>
          <th>Tarikh Edar</th>
          <th>Catatan</th>
          <th>Tindakan</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

</div>

<!-- XLSX LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
let data = JSON.parse(localStorage.getItem("suratUU")) || [];
const tbody = document.getElementById("tbody");

function render(list){
  tbody.innerHTML = "";

  if(list.length === 0){
    tbody.innerHTML =
      `<tr><td colspan="11" class="empty">Tiada rekod surat</td></tr>`;
    return;
  }

  list.forEach((s,i)=>{
    tbody.innerHTML += `
      <tr>
        <td>${s.bil}</td>
        <td>${s.kategori}</td>
        <td>${s.namaPengirim}</td>
        <td>${s.tarikhTerima || "-"}</td>
        <td>${s.tarikhSurat || "-"}</td>
        <td>${s.perkara}</td>
        <td>${(s.minit || []).join(", ")}</td>
        <td>${s.kepada || "-"}</td>
        <td>${s.tarikhEdar || "-"}</td>
        <td>${s.catatan || "-"}</td>
        <td>
          <button class="action-btn edit" onclick="editSurat(${i})">Edit</button>
          <button class="action-btn delete" onclick="padamSurat(${i})">Padam</button>
        </td>
      </tr>`;
  });
}

render(data);

function applyFilter(){
  const keyword = searchInput.value.toLowerCase();
  const bulan = bulanFilter.value;
  const kategori = kategoriFilter.value;

  const filtered = data.filter(s=>{
    if(keyword &&
      !s.perkara.toLowerCase().includes(keyword) &&
      !s.namaPengirim.toLowerCase().includes(keyword)
    ) return false;

    if(kategori && s.kategori !== kategori) return false;
    if(bulan && s.tarikhTerima?.substring(5,7) !== bulan) return false;

    return true;
  });

  render(filtered);
}

function tambahSurat(){
  localStorage.removeItem("editIndex");
  location.href="admin-form.html";
}

function editSurat(i){
  localStorage.setItem("editIndex", i);
  location.href="admin-form.html";
}

function padamSurat(i){
  if(confirm("Padam surat ini?")){
    data.splice(i,1);
    localStorage.setItem("suratUU", JSON.stringify(data));
    render(data);
  }
}

function logout(){
  location.href="surat.html";
}

/* ===== EXPORT EXCEL ===== */
function exportExcel(){
  let data = JSON.parse(localStorage.getItem("suratUU")) || [];

  if(data.length === 0){
    alert("Tiada data untuk dibackup");
    return;
  }

  const excelData = data.map((s,i)=>({
    "Bil": s.bil || i+1,
    "Kategori": s.kategori || "",
    "Pengirim": s.namaPengirim || "",
    "Tarikh Terima": s.tarikhTerima || "",
    "Tarikh Surat": s.tarikhSurat || "",
    "Perkara / Tajuk": s.perkara || "",
    "Minit Tindakan": (s.minit || []).join(" | "),
    "Kepada": s.kepada || "",
    "Tarikh Edar": s.tarikhEdar || "",
    "Catatan": s.catatan || ""
  }));

  const worksheet = XLSX.utils.json_to_sheet(excelData);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, "Surat Masuk");

  XLSX.writeFile(workbook, "Backup_Surat_Unit_UndangUndang.xlsx");
}
</script>

</body>
</html>
